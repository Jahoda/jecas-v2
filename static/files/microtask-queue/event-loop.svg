<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650">
  <defs>
    <style>
      /* Podpora dark mode */
      @media (prefers-color-scheme: dark) {
        .title { fill: #e0e0e0; }
        .label { fill: #e0e0e0; }
        .small-text { fill: #b0b0b0; }
        .box-bg { fill: #2a2a2a; }
        .arrow-line { stroke: #666; }
      }
      @media (prefers-color-scheme: light) {
        .title { fill: #1a1a1a; }
        .label { fill: #1a1a1a; }
        .small-text { fill: #666; }
        .box-bg { fill: #ffffff; }
        .arrow-line { stroke: #999; }
      }

      /* Obecné styly */
      .title { font: bold 28px system-ui, sans-serif; }
      .label { font: bold 18px system-ui, sans-serif; }
      .label-medium { font: 16px system-ui, sans-serif; }
      .small-text { font: 14px system-ui, sans-serif; }
      .priority { font: bold 24px system-ui, sans-serif; fill: white; }

      /* Call Stack */
      .callstack-box { fill: #f5f5f5; stroke: #4caf50; stroke-width: 3; }
      .callstack-item { fill: #4caf50; stroke: #2e7d32; stroke-width: 2; }
      .callstack-text { fill: white; font: 14px system-ui, sans-serif; }

      /* Microtask Queue */
      .microtask-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 3; }
      .microtask-item { fill: #2196f3; stroke: #1565c0; stroke-width: 2; }
      .microtask-text { fill: white; font: 13px system-ui, sans-serif; }
      .microtask-priority { fill: #1976d2; font: bold 20px system-ui, sans-serif; }

      /* Task Queue */
      .task-box { fill: #fff8e1; stroke: #f57c00; stroke-width: 3; }
      .task-item { fill: #ff9800; stroke: #e65100; stroke-width: 2; }
      .task-text { fill: white; font: 13px system-ui, sans-serif; }
      .task-priority { fill: #f57c00; font: bold 20px system-ui, sans-serif; }

      /* Event Loop */
      .loop-outer { fill: #fff3e0; stroke: #f57f17; stroke-width: 3; }
      .loop-inner { fill: #ffc107; }
      .loop-text { fill: #1a1a1a; font: bold 16px system-ui, sans-serif; }

      /* Šipky */
      .arrow-microtask { stroke: #1976d2; stroke-width: 3; fill: none; }
      .arrow-task { stroke: #f57c00; stroke-width: 3; fill: none; }
      .arrow-return { stroke: #4caf50; stroke-width: 3; fill: none; stroke-dasharray: 5,5; }
    </style>

    <!-- Arrow markers -->
    <marker id="arrow-micro" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976d2" />
    </marker>
    <marker id="arrow-task-marker" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f57c00" />
    </marker>
    <marker id="arrow-return-marker" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4caf50" />
    </marker>
  </defs>

  <!-- Titulek -->
  <text x="450" y="40" text-anchor="middle" class="title">Event Loop s Microtask Queue</text>

  <!-- Call Stack (vlevo nahoře) -->
  <g id="callstack">
    <rect x="50" y="80" width="200" height="200" class="callstack-box" rx="8"/>
    <text x="150" y="110" text-anchor="middle" class="label">Call Stack</text>
    <text x="150" y="132" text-anchor="middle" class="small-text">(Zásobník volání)</text>

    <!-- Stack položky -->
    <rect x="70" y="155" width="160" height="38" class="callstack-item" rx="4"/>
    <text x="150" y="179" text-anchor="middle" class="callstack-text">main()</text>

    <rect x="70" y="200" width="160" height="38" class="callstack-item" rx="4" opacity="0.6"/>
    <text x="150" y="224" text-anchor="middle" class="callstack-text">funkce()</text>
  </g>

  <!-- Event Loop (střed) -->
  <g id="eventloop">
    <ellipse cx="450" cy="320" rx="90" ry="65" class="loop-outer"/>
    <ellipse cx="450" cy="320" rx="75" ry="52" class="loop-inner"/>
    <text x="450" y="315" text-anchor="middle" class="loop-text">Event</text>
    <text x="450" y="335" text-anchor="middle" class="loop-text">Loop</text>

    <!-- Rotační šipky kolem event loop -->
    <path d="M 450 255 Q 520 280 520 320" class="arrow-line" fill="none" stroke-width="2" opacity="0.4"/>
    <path d="M 520 320 Q 520 360 450 385" class="arrow-line" fill="none" stroke-width="2" opacity="0.4"/>
  </g>

  <!-- Microtask Queue (vpravo nahoře) -->
  <g id="microtask">
    <rect x="650" y="80" width="200" height="220" class="microtask-box" rx="8"/>
    <text x="750" y="110" text-anchor="middle" class="label">Microtask Queue</text>
    <text x="750" y="132" text-anchor="middle" class="small-text">(Vysoká priorita)</text>
    <text x="830" y="110" text-anchor="middle" class="microtask-priority">①</text>

    <!-- Microtask položky -->
    <rect x="670" y="155" width="160" height="30" class="microtask-item" rx="4"/>
    <text x="750" y="175" text-anchor="middle" class="microtask-text">Promise.then()</text>

    <rect x="670" y="192" width="160" height="30" class="microtask-item" rx="4"/>
    <text x="750" y="212" text-anchor="middle" class="microtask-text">queueMicrotask()</text>

    <rect x="670" y="229" width="160" height="30" class="microtask-item" rx="4"/>
    <text x="750" y="249" text-anchor="middle" class="microtask-text">async/await</text>

    <rect x="670" y="266" width="160" height="30" class="microtask-item" rx="4" opacity="0.5"/>
    <text x="750" y="286" text-anchor="middle" class="microtask-text">MutationObserver</text>
  </g>

  <!-- Task Queue (vpravo dole) -->
  <g id="taskqueue">
    <rect x="650" y="350" width="200" height="220" class="task-box" rx="8"/>
    <text x="750" y="380" text-anchor="middle" class="label">Task Queue</text>
    <text x="750" y="402" text-anchor="middle" class="small-text">(Macro Task)</text>
    <text x="830" y="380" text-anchor="middle" class="task-priority">②</text>

    <!-- Task položky -->
    <rect x="670" y="425" width="160" height="30" class="task-item" rx="4"/>
    <text x="750" y="445" text-anchor="middle" class="task-text">setTimeout()</text>

    <rect x="670" y="462" width="160" height="30" class="task-item" rx="4"/>
    <text x="750" y="482" text-anchor="middle" class="task-text">setInterval()</text>

    <rect x="670" y="499" width="160" height="30" class="task-item" rx="4"/>
    <text x="750" y="519" text-anchor="middle" class="task-text">click, scroll...</text>

    <rect x="670" y="536" width="160" height="30" class="task-item" rx="4" opacity="0.5"/>
    <text x="750" y="556" text-anchor="middle" class="task-text">I/O operace</text>
  </g>

  <!-- Šipky -->
  <!-- Call Stack -> Event Loop -->
  <path d="M 250 180 L 360 280" class="arrow-return" marker-end="url(#arrow-return-marker)"/>
  <text x="290" y="220" class="small-text" fill="#4caf50">prázdný?</text>

  <!-- Event Loop -> Microtask -->
  <path d="M 540 300 L 645 200" class="arrow-microtask" marker-end="url(#arrow-micro)"/>
  <text x="580" y="240" class="small-text" fill="#1976d2">priorita 1</text>

  <!-- Event Loop -> Task -->
  <path d="M 540 340 L 645 460" class="arrow-task" marker-end="url(#arrow-task-marker)"/>
  <text x="580" y="410" class="small-text" fill="#f57c00">priorita 2</text>

  <!-- Zpětné šipky (přerušované) -->
  <path d="M 650 170 Q 450 120 250 150" class="arrow-return" marker-end="url(#arrow-return-marker)"/>
  <path d="M 650 440 Q 450 500 250 250" class="arrow-return" marker-end="url(#arrow-return-marker)"/>

  <!-- Pořadí vykonávání (dole) -->
  <rect x="50" y="590" width="800" height="45" fill="#f5f5f5" stroke="#ddd" stroke-width="2" rx="6"/>
  <text x="450" y="610" text-anchor="middle" class="label">Pořadí vykonávání:</text>
  <text x="450" y="628" text-anchor="middle" class="small-text">
    <tspan fill="#4caf50">①&nbsp;Synchronní&nbsp;kód</tspan>
    <tspan> → </tspan>
    <tspan fill="#1976d2">②&nbsp;Všechny&nbsp;microtasky</tspan>
    <tspan> → </tspan>
    <tspan fill="#666">③&nbsp;Rendering</tspan>
    <tspan> → </tspan>
    <tspan fill="#f57c00">④&nbsp;Jeden&nbsp;task</tspan>
  </text>
</svg>
